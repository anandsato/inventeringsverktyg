function listSubmittedEntries(){if(localStorage.submittedEntries){$("#list-submitted-entries").empty();var a=JSON.parse(localStorage.submittedEntries);$.each(a,function(a,b){var c=new Date(b.timestamp+36e5);c=c.toJSON().substring(0,16),$("<li><a  id='"+b.timestamp+"'>Sparad: "+c+"</a></li>").appendTo("#list-submitted-entries")})}else $("<li>Du har inga sparade checklistor att ladda upp</li>").appendTo("#list-submitted-entries");$("#list-submitted-entries").listview().listview("refresh")}function listPreviousSubmissions(){localStorage.previousSubmissions&&($.each(JSON.parse(localStorage.previousSubmissions),function(a,b){var c=0;if(5==c)return!1;var d=new Date(b.timestamp+36e5);d=d.toJSON().substring(0,16),$("<li><a id='"+b.form_id+"' class='previousSubmissionObject' name="+b.timestamp+"><h3>"+b.form_name+"</h3><p>Sparad: "+d+"</p></a></li>").appendTo("#list-all-previous-submissions"),c++}),$("#list-all-previous-submissions").listview().listview("refresh"))}function arrayLengthSubmittedEntries(){if(localStorage.submittedEntries){var a=JSON.parse(localStorage.submittedEntries);a.length>0&&$("#entries-array-length").html("- Du har "+a.length+" formul&auml;r att ladda upp.")}}function repopulateForm(a){$.each(a,function(a,b){var c=$('[name="'+a+'"]'),d=c.attr("type");switch(d){case"checkbox":b instanceof Array?$.each(b,function(a,b){c.filter('[value="'+b+'"]').attr("checked","checked")}):c.filter('[value="'+b+'"]').attr("checked","checked");break;case"radio":c.filter('[value="'+b+'"]').attr("checked","checked");break;default:c.val(b)}})}function displayChecklist(a,b){var c=$("#myform").dform(a);c.promise().done(function(){a.name&&(console.log(a.name),$("#checklist-name").html(a.name)),$.dform.addType("h2",function(a){return $("<h2>").dform("attr",a)}),$.dform.addType("textarea",function(a){return $("<textarea>").dform("attr",a)}),$("#formpage").trigger("create"),$.mobile.navigate("#formpage"),void 0==b||repopulateForm(b)})}function storePreviousSubmission(a){$.each(a,function(b,c){c.name.startsWith("imagedata")&&delete a[b]});var b={},c=a;$.each(c,function(){void 0!==b[this.name]?(b[this.name].push||(b[this.name]=[b[this.name]]),b[this.name].push(this.value||"")):b[this.name]=this.value||""});var d={};d.form_id=b.form_id,d.form_name=b.form_name,d.submitted_entry=b,d.timestamp=(new Date).getTime(),console.log(d);var e;e=localStorage.previousSubmissions?JSON.parse(localStorage.previousSubmissions):[],e.unshift(d),e.length>5&&e.pop(),localStorage.previousSubmissions=JSON.stringify(e)}function storeSubmittedEntry(a,b){var c={};c.timestamp=(new Date).getTime(),c.submission_string=a,c.form_id=b;var d;d=localStorage.submittedEntries?JSON.parse(localStorage.submittedEntries):[],d.push(c),localStorage.submittedEntries=JSON.stringify(d)}function uploadSubmittedEntries(){if(localStorage.submittedEntries){var a=JSON.parse(localStorage.submittedEntries),b=a.length,c=0;$.each(a,function(a,d){c++;var e=$.ajax({type:"POST",url:"http://fonstertitt.appspot.com/submit",data:d.submission_string,crossDomain:!0});e.promise().done(function(a){if(a!=d.form_id)return alert("uppladdningen stoppade!"+JSON.stringify(a)),!1;var e=$("#"+d.timestamp);$("<p>Uppladdningen lyckades!</p>").appendTo(e),e.fadeOut(2300,function(){$(this).remove()}),c==b&&(localStorage.submittedEntries="")}).fail(function(a){alert("uppladdningen misslyckades!"+JSON.stringify(a))})})}}function onDeviceReady(){function a(a,b){$("<input>",{type:"hidden",name:"imagedata"+a,id:"imagedata"+a,value:"data:image/jpeg;base64,"+b}).insertAfter("#"+a),$("<a>",{"class":"del-image-input",href:"#",id:a}).html("Ta bort bild").insertAfter("#"+a)}function b(){if(navigator.connection.type!==Connection.NONE){var a=$.getJSON("http://fonstertitt.appspot.com/list-all-forms");a.promise().done(function(a){localStorage.removeItem("checklists"),localStorage.checklists=JSON.stringify(a),$.each(a,function(a,b){$("<li><a class='checklistObject' id='"+b.id+"'>"+b.name+"</a></li>").appendTo("#list-all-forms")}),$("#list-all-forms").listview().listview("refresh")})}else{var b=JSON.parse(localStorage.checklists);$.each(b,function(a,b){$("<li><a class='checklistObject' id='"+b.id+"'>"+b.name+"</a></li>").appendTo("#list-all-forms")}),$("#list-all-forms").listview().listview("refresh")}}cordova.exec.setJsToNativeBridgeMode(cordova.exec.jsToNativeModes.XHR_NO_PAYLOAD),$(document).on("click",".camera",function(){function c(c){navigator.camera.getPicture(function(b){a(c,b)},function(){alert("Fel, bildfunktionen fungerar inte")},b)}if(!navigator.camera)return alert("Camera API not supported","Error"),void 0;var b={quality:65,destinationType:Camera.DestinationType.DATA_URL,sourceType:1,encodingType:0,correctOrientation:!0,targetWidth:700,targetHeight:700};c(this.id)}),setInterval(function(){navigator.connection.type!==Connection.NONE?$("#connection").html("- Du &auml;r uppkopplad till internet."):$("#connection").html("- Du har ingen anslutning till internet och kan inte skicka checklistor till servern.")},5250),$(document).on("submit","form",function(a){var b=$("input[name='form_id']").attr("value");console.log(b),a.preventDefault(),a.stopPropagation();var c=$(this).serializeArray();storePreviousSubmission(c);var d=$(this).serialize();storeSubmittedEntry(d,b),alert("Checklistan sparad."),document.location.href="index.html"}),b(),arrayLengthSubmittedEntries(),$("#reload-checklists").click(function(){$("#list-all-forms").empty(),b()}),$("#backwards").click(function(){document.location.href="index.html"}),$("#reload-app").click(function(){document.location.href="index.html"}),$("#remove-previous-submissions").click(function(){alert("Nu kommer vi ta bort tidigare sparade checklistor."),localStorage.previousSubmissions="",localStorage.previousSubmissions?console.log("not empty"):console.log("empty!"),document.location.href="index.html"}),listSubmittedEntries(),listPreviousSubmissions(),$(document).on("click",".checklistObject",function(){var a=JSON.parse(localStorage.checklists),b=$(this).attr("id");$.each(a,function(a,c){c.id==b&&displayChecklist(c,void 0)})}),$(document).on("click",".previousSubmissionObject",function(){var a=JSON.parse(localStorage.previousSubmissions),b=JSON.parse(localStorage.checklists),c=this.id,d=this.name;$.each(b,function(b,e){e.id==c&&$.each(a,function(a,b){b.timestamp==d&&displayChecklist(e,b.submitted_entry)})})}),$("#backwards").click(function(){$("form").empty(),$("form").attr("id","myform")}),$("#upload-submitted-entries").click(function(){uploadSubmittedEntries()}),$("#upload-submitted-entries2").click(function(){uploadSubmittedEntries()}),$(document).on("click",".del-image-input",function(){imageId=$(this).attr("id"),imageVar="#outputImage"+imageId,$("a#"+imageId+".del-image-input").remove(),$("#imagedata"+imageId).remove()})}String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(a,b){return b=b||0,this.lastIndexOf(a,b)===b}}),document.addEventListener("deviceready",onDeviceReady,!1);